---
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const tags = [...new Set(allPosts.map((post) => post.data.tags).flat())];
const rawBase = import.meta.env.BASE_URL;
const base = rawBase === '/' ? '' : rawBase.replace(/\/$/, '');
---

<div class="sidebar">
    <div class="widget about">
        <h3>Acerca de</h3>
        <p>
            Descubre en Código ergo sum cómo los cambios laborales y tecnológicos están transformando los negocios. Exploramos desarrollo de software, gestión del tiempo e impacto de la inteligencia artificial. Únete y navega el panorama laboral con éxito.
        </p>
    </div>
    <div class="widget tags">
        <h3>Etiquetas</h3>
        <div class="tag-cloud">
            {tags.map((tag) => (
                <a href={`${base}/tags/${tag}`} class="tag">#{tag}</a>
            ))}
        </div>
    </div>
</div>

<style>
    .sidebar {
        position: sticky;
        top: 2rem;
    }
    .widget {
        background: rgb(var(--gray-light));
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    .widget h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1.2rem;
        border-bottom: 2px solid rgb(var(--accent));
        padding-bottom: 0.5rem;
        display: inline-block;
    }
    .tag-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    .tag {
        background: rgba(var(--gray-light), 0.6);
        padding: 0.25rem 0.65rem;
        border-radius: 6px;
        font-size: 0.85rem;
        text-decoration: none;
        color: rgb(var(--gray-dark));
        border: 1px solid rgba(var(--gray), 0.25);
        line-height: 1.2;
        transition: background .2s, color .2s;
    }
    .tag:hover {
        background: rgb(var(--accent));
        color: #fff;
    }

    /* Dark mode tweaks */
    @media (prefers-color-scheme: dark) {
      .widget { background: rgba(var(--white), 0.06); }
      .widget.tags { background: rgba(var(--white), 0.08); }
      .tag { background: rgba(var(--gray-light), 0.35); color: rgb(var(--black)); border-color: rgba(var(--gray), 0.3); }
      .tag:hover { background: rgb(var(--accent)); color: #fff; }
      .widget h3 { color: rgb(var(--black)); }
    }
</style>
